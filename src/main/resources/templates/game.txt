<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Minesweeper Game</title>
</head>
<body>
<h2>Minesweeper Game</h2>
<form method="post" th:action="@{/game/start}">
    <label for="difficulty">Select Difficulty:</label>
    <select id="difficulty" name="difficulty">
        <option value="BEGINNER">Beginner</option>
        <option value="INTERMEDIATE">Intermediate</option>
        <option value="EXPERT">Expert</option>
    </select>
    <button type="submit">Start Game</button>
</form>
<div th:if="${game}">
    <h3>Game ID: <span th:text="${game.id}"></span></h3>
    <h4>Difficulty: <span th:text="${game.difficulty}"></span></h4>
    <h4>Status: <span th:text="${game.gameOver ? (game.won ? 'Won' : 'Lost') : 'In Progress'}"></span></h4>
    <div>
        <label>Row:</label>
        <input id="row" name="row" type="number"/>
        <label>Col:</label>
        <input id="col" name="col" type="number"/>
        <button onclick="makeMove()" type="button">Make Move</button>
    </div>
    <script>
        function makeMove() {
            const row = document.getElementById('row').value;
            const col = document.getElementById('col').value;
            const gameId = /*[[${game.id}]]*/ '';
            const csrfToken = /*[[${_csrf.token}]]*/ '';

            fetch(`/game/${gameId}/move`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRF-TOKEN': csrfToken
                },
                body: `row=${row}&col=${col}`
            }).then(response => response.text())
              .then(html => {
                  document.open();
                  document.write(html);
                  document.close();
              });
        }
    </script>
</div>
</body>
</html>